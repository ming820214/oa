<layout name='Layout/ace_layout' />
{:W('PageHeader',array('name'=>'校长薪酬计算','search'=>'A'))}
<include file="search" />
<div class="row">
	<table class="table table-bordered" id="rule">
		<thead>
			<tr>
				<th>员工ID</th>
				<th>姓名</th>
				<th>单位</th>
				<th>职务级别</th>
				<th hd="1">应出勤</th>
				<th hd="1">核算出勤</th>
				<th hd="1">是否满勤</th>
				<th hd="1">绩效系数</th>
				<th hd="1">课时消耗</th>
				<th hd="1">消耗完成率</th>
				<th hd="1">个人招生业绩</th>
				<th hd="1">个人消耗业绩</th>
				<th hd="1">团队业绩</th>
				<th hd="1">团队消耗</th>
				<th hd="2">社保补贴</th>
				<th hd="2">拓展补贴</th>
				<th hd="2">督学奖金</th>
				<th hd="2">组长提成</th>
				<th hd="2">其他奖金</th>
				<th hd="2">退费扣款</th>
				<th hd="3">其它扣款</th>
				<th hd="3">个人借款</th>
				<th hd="3">借款归还</th>
				<th hd="3">个人补充医疗保险</th>
				<th hd="3">单位补充医疗保险</th>
				<th hd="3">备注</th>
				<th width="160px"></th>
			</tr>
		</thead>
		<tbody>
	<!-- 添加兼职工资明细部分 -->
			<tr save="0" bgcolor="beige" id="other_xc" style="display:none;">
				<td class="pid"></td>
				<th>++>></th>
				<th><select name="school" class="col-10"><option></option>{:W('School')}</select></th>
				<th><select name="level"><option></option><volist name="level" id="vo"><option>{$vo}</option></volist></select></th>
				<td hd="1" class="r">{$vre}</td>
				<td hd="1" class="s">{$v.s}</td>
				<td hd="1" class="t">{$v.t}</td>
				<td hd="1" class="p">{$v.p}</td>
				<td hd="1" class="xz_j">{$v.xz_j}</td>
				<td hd="1" class="xz_u">{$v.xz_u}</td>
				<td hd="1" class="xz_w">{$v.xz_w}</td>
				<td hd="1" class="xz_ae">{$v.xz_ae}</td>
				<td hd="1" class="xz_ak">{$v.xz_ak}</td>
				<td hd="1" class="xz_an">{$v.xz_an}</td>
				<td hd="2" class="xz_aq">{$v.xz_aq}</td>
				<td hd="2" class="xz_ar">{$v.xz_ar}</td>
				<td hd="2" class="xz_as">{$v.xz_as}</td>
				<td hd="2" class="xz_at">{$v.xz_at}</td>
				<td hd="2" class="xz_au">{$v.xz_au}</td>
				<td hd="2" class="xz_av">{$v.xz_av}</td>
				<td hd="3" class="xz_aw">{$v.xz_aw}</td>
				<td hd="3" class="bn">{$v.bn}</td>
				<td hd="3" class="bo">{$v.bo}</td>
				<td hd="3" class="bu_geren">{$v.bu_geren}</td>
				<td hd="3" class="bu_danwei">{$v.bu_danwei}</td>
				<td hd="3" class="cd">{$v.cd}</td>
				<th><input class="btn btn-sm btn-danger" name="other_add" onclick="location=location"  value="添加兼职记录"/></th>
			</tr>
<!-- 正常薪酬核算 -->
			<volist name='list' id='v'>
			<tr id="{$v.id}" save="{$v.state}" <if condition="$v.type eq 1">bgcolor="beige"</if>>
				<th>{$v.pid}</th>
				<th>{$v.name}</th>
				<th>{$v.school}</th>
				<th><select name="level"><option>{$v.level}</option><volist name="level" id="vo"><option>{$vo}</option></volist></select></th>
				<td hd="1" class="r">{$vre}</td>
				<td hd="1" class="s">{$v.s}</td>
				<td hd="1" class="t">{$v.t}</td>
				<td hd="1" class="p">{$v.p}</td>
				<td hd="1" class="xz_j">{$v.xz_j}</td>
				<td hd="1" class="xz_u">{$v.xz_u}</td>
				<td hd="1" class="xz_w">{$v.xz_w}</td>
				<td hd="1" class="xz_ae">{$v.xz_ae}</td>
				<td hd="1" class="xz_ak">{$v.xz_ak}</td>
				<td hd="1" class="xz_an">{$v.xz_an}</td>
				<td hd="2" class="xz_aq">{$v.xz_aq}</td>
				<td hd="2" class="xz_ar">{$v.xz_ar}</td>
				<td hd="2" class="xz_as">{$v.xz_as}</td>
				<td hd="2" class="xz_at">{$v.xz_at}</td>
				<td hd="2" class="xz_au">{$v.xz_au}</td>
				<td hd="2" class="xz_av">{$v.xz_av}</td>
				<td hd="3" class="xz_aw">{$v.xz_aw}</td>
				<td hd="3" class="bn">{$v.bn}</td>
				<td hd="3" class="bo">{$v.bo}</td>
				<td hd="3" class="bu_geren">{$v.bu_geren}</td>
				<td hd="3" class="bu_danwei">{$v.bu_danwei}</td>
				<td hd="3" class="cd">{$v.cd}</td>
				<th><a href="javascript:void(0);" onclick="hs({$v.id})" class="btn btn-sm btn-primary">详情</a><if condition="$v.state eq 0"><a href="javascript:void(0);" onclick="save(this)" class="btn btn-sm btn-primary">存档</a><if condition="$v.type eq 1"><a onclick="xc_other_delt(this)" class="btn btn-sm btn-primary">-</a></if></if></th>
			</tr>
			</volist>
		</tbody>
	</table>
</div>
<div>{$page}</div>
<div id="hs"><a onclick="$(this).parent().hide();" class="clos">X</a>
	<div id="hss"></div>
</div>

<script type="text/javascript">
	$("td[hd],th[hd]").hide();
	$("td[hd='1'],th[hd='1']").show();
	$("td").blur(function () {
		var id = $(this).parent().attr("id");
		var aa = $(this).attr("class");
		var info = $(this).text();
		$.post("{:U('xc_xc2')}",{id:id,aa:aa,info:info});
	})
	$("table select").change(function(){
		var id = $(this).parent().parent().attr("id");
		var aa = $(this).attr("name");
		var info = $(this).val();
		$.post("{:U('xc_xc2')}",{id:id,aa:aa,info:info});		
	})
	function hd(i){
		$("td[hd],th[hd]").hide();
		if(i==1)$("td[hd='1'],th[hd='1']").show();
		if(i==2)$("td[hd='2'],th[hd='2']").show();
		if(i==3)$("td[hd='3'],th[hd='3']").show();
	}
	//显示核算的薪酬
	function hs(i){
		$("#hs").show();
		$("#hss").empty();
		$.get("{:U('xc_xc22')}",{i:i},function(msg){
			$("#hss").append(msg);
		});
	}
	//存档数据
	function save(th){
		var id=$(th).parents("tr").attr("id");
		$(th).parents("tr").children("td").removeAttr("contenteditable");
		$.get("{:U(xc_xc1)}&save="+id);
		$(th).hide();
	}

	$("tr").each(function(){
		if($(this).attr("save")==0){
			$(this).children("td").attr({contenteditable:true});
		}
	})
	//附加新的工资项目
	function xc_other(){
		$.getJSON("{:U('xc_other')}&id=-2",function(msg){
			$("#other_xc").attr("id",msg);
		});
		$("#other_xc").show();
	}
	//删除兼职工资条
	function xc_other_delt(th){
		var id=$(th).parents("tr").attr("id");
		$.get("{:U('xc_other')}",{delt:id},function(msg){
			if(msg=='ok')$(th).parents("tr").remove();
		})
	}
</script>
<style type="text/css">
#hs{
	width: 900px;
	height: 140px;
	bottom: 300px;
	position: fixed;
	padding: 20px;
	margin-left: 50%;
	left: -450px;
	background: beige;
	display: none;
	z-index: 9999;
}
#hss{
	width: 100%;
	overflow-x: auto;
}
.clos {
	position: absolute;
	top: 5px;
	right: 15px;
	font-size: 20px;
	color: brown;
	cursor: pointer;
}
</style>